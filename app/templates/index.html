{% extends "base.html" %}
{% block title %}Dashboard — Inventário{% endblock %}
{% block content %}

<!-- ===================== HERO / RESUMO ===================== -->
<section class="card" style="
  padding:22px;
  position:relative;
  overflow:hidden;
  max-width:100%;
">
  <!-- glows (ok), mas o container está com overflow hidden -->
  <div aria-hidden="true" style="position:absolute;inset:-140px auto auto -140px;width:320px;height:320px;background:rgba(255,106,0,.14);filter:blur(50px);border-radius:999px;"></div>
  <div aria-hidden="true" style="position:absolute;inset:-180px -180px auto auto;width:380px;height:380px;background:rgba(255,106,0,.08);filter:blur(60px);border-radius:999px;"></div>

  <div style="position:relative;">
    <h1 style="margin:0;font-size:1.55rem;font-weight:950;letter-spacing:.2px;">
      Inventário — Visão Geral
    </h1>
    <p class="muted" style="margin:.55rem 0 0;max-width:70ch;line-height:1.55;">
      Totais do inventário e distribuição de equipamentos por setor e por localização.
    </p>
  </div>

  <!-- Totais (responsivo) -->
  <div style="
    position:relative;
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap:16px;
    margin-top:22px;
  ">
    <div class="card" style="padding:18px;border-radius:20px;min-width:0;">
      <div class="muted small">Localizações</div>
      <div style="font-size:2.2rem;font-weight:950;margin-top:6px;line-height:1;">
        {{ counts.locations }}
      </div>
      <div class="muted small" style="margin-top:8px;">localizações cadastradas</div>
    </div>

    <div class="card" style="padding:18px;border-radius:20px;min-width:0;">
      <div class="muted small">Setores</div>
      <div style="font-size:2.2rem;font-weight:950;margin-top:6px;line-height:1;">
        {{ counts.sectors }}
      </div>
      <div class="muted small" style="margin-top:8px;">setores cadastrados</div>
    </div>

    <div class="card" style="padding:18px;border-radius:20px;min-width:0;">
      <div class="muted small">Equipamentos</div>
      <div style="font-size:2.2rem;font-weight:950;margin-top:6px;line-height:1;">
        {{ counts.equipments }}
      </div>
      <div class="muted small" style="margin-top:8px;">equipamentos no inventário</div>
    </div>
  </div>

  <!-- ✅ CSS inline só para este template (resolve o overflow no mobile) -->
  <style>
    /* impede qualquer scroll horizontal no conteúdo desta página */
    .page { overflow-x: hidden; }

    /* Totais: 3 -> 2 -> 1 colunas */
    @media (max-width: 980px){
      .dash-totals{ grid-template-columns: repeat(2, minmax(0, 1fr)) !important; }
    }
    @media (max-width: 560px){
      .dash-totals{ grid-template-columns: 1fr !important; }
    }

    /* Colunas principais: 2 -> 1 */
    @media (max-width: 980px){
      .dash-two{ grid-template-columns: 1fr !important; }
    }

    /* grids internos: 2 -> 1 */
    @media (max-width: 560px){
      .dash-inner{ grid-template-columns: 1fr !important; }
    }
  </style>

</section>

<script>
  // aplica classes nos grids acima (sem reescrever tudo)
  // (safe: executa rápido e evita ter que repetir css em todo lugar)
  (function(){
    const totals = document.querySelectorAll('[data-grid="totals"]');
    totals.forEach(el => el.classList.add('dash-totals'));
    const two = document.querySelectorAll('[data-grid="two"]');
    two.forEach(el => el.classList.add('dash-two'));
    const inner = document.querySelectorAll('[data-grid="inner"]');
    inner.forEach(el => el.classList.add('dash-inner'));
  })();
</script>

<!-- ===================== SETORES + LOCALIZAÇÕES ===================== -->
<section data-grid="two" style="
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:16px;
  margin-top:16px;
  align-items:start;
  max-width:100%;
">

  <!-- SETORES -->
  <section class="card" style="padding:20px;min-width:0;">
    <h2 style="margin:0;font-size:1.12rem;font-weight:900;">Equipamentos por Setor</h2>
    <p class="muted small" style="margin:.5rem 0 0;">Distribuição de equipamentos por setor</p>

    <div data-grid="inner" style="
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:16px;
      margin-top:16px;
      max-width:100%;
    ">
      {% for row in by_sector %}
        <a
          href="{{ url_for('main.equipments_list', sector_id=row.id) }}"
          class="card"
          style="
            padding:18px;
            border-radius:20px;
            min-width:0;
            display:block;
          "
        >
          <div class="muted small" style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
            {{ row.name }}
          </div>
          <div style="font-size:2.05rem;font-weight:950;margin-top:10px;line-height:1;">
            {{ row.count }}
          </div>
          <div class="muted small" style="margin-top:8px;">Equipamentos</div>
        </a>
      {% else %}
        <div class="muted small">Nenhum setor cadastrado.</div>
      {% endfor %}
    </div>
  </section>

  <!-- LOCALIZAÇÕES -->
  <section class="card" style="padding:20px;min-width:0;">
    <h2 style="margin:0;font-size:1.12rem;font-weight:900;">Equipamentos por Localização</h2>
    <p class="muted small" style="margin:.5rem 0 0;">Distribuição de equipamentos por localização</p>

    <div data-grid="inner" style="
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:16px;
      margin-top:16px;
      max-width:100%;
    ">
      {% for row in by_location %}
        <a
          href="{{ url_for('main.equipments_list', location_id=row.id) }}"
          class="card"
          style="
            padding:18px;
            border-radius:20px;
            min-width:0;
            display:block;
          "
        >
          <div class="muted small" style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
            {{ row.name }}
          </div>
          <div style="font-size:2.05rem;font-weight:950;margin-top:10px;line-height:1;">
            {{ row.count }}
          </div>
          <div class="muted small" style="margin-top:8px;">Equipamentos</div>
        </a>
      {% else %}
        <div class="muted small">Nenhuma localização cadastrada.</div>
      {% endfor %}
    </div>
  </section>

</section>

<script>
  // marca o grid de totais (primeiro grid dentro do hero)
  (function(){
    const hero = document.querySelector('section.card');
    if(!hero) return;
    const grids = hero.querySelectorAll('div[style*="display:grid"]');
    if(grids && grids[0]) grids[0].setAttribute('data-grid','totals');
  })();
</script>

{% endblock %}
